---
- name: List groups for all openstack hosts
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    guid: 3365
    internal_domain: "example.com"
  tasks:
    - name: Collection instance info
      os_server_info:
        cloud: "{{ guid }}-project"
      register: instances

    - name: print groups on the go 
      debug:
        msg: "FOUND ONE: {{ instance.metadata.AnsibleGroup }}"
      when: instance.metadata.AnsibleGroup == "app_servers"
      loop: "{{ instances.openstack_servers }}"
      loop_control:
        loop_var: instance

    - name: print deployment_name
      debug:
        msg: "FOUND ONE: {{ instance.metadata.AnsibleGroup }}"
      when: instance.metadata.DeployName is defined and instance.metadata.DeployName == "dev"
      loop: "{{ instances.openstack_servers }}"
      loop_control:
        loop_var: instance

#- name: Print current hosts
#  hosts: localhost
#  connection: local
#  gather_facts: false
#  tasks:
#    - debug: var=groups
